CC = gcc

#定义不同的编译选项
CFLAGS_DEBUG = -Wall -g -std=c99 -O0 -fno-omit-frame-pointer
CFLAGS_RELEASE = -Wall -std=c99 -O2

CFLAGS = $(CFLAGS_DEBUG)

SUB_DIRS = $(wildcard ex*)
TARGETS = $(foreach dir,$(SUB_DIRS),$(dir)/$(dir))

all:$(TARGETS)

%: %.c
	$(CC) $(CFLAGS) $< -o $@

debug:CFLAGS = $(CFLAGS_DEBUG)
debug:$(TARGETS)

release: CFLAGS = $(CFLAGS_RELEASE)
release:$(TARGEST)

gdb-%: 
	@echo "============ $* ============="
	gdb -tui ./$*/$*
	@echo "============ $* ============="


valgrind: $(TARGETS)
	for target in $(TARGETS); do \
		echo "============ $$target ============="; \
		valgrind --leak-check=full ./$$target; \
		echo "============ $$target ============="; \
	done

clean:
	for dir in $(SUB_DIRS); do	\
		rm -f $$dir/$$dir;	\
	done
